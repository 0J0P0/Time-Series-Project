---
title: "Project"
author: "Juan Pablo Zaldivar && Enric Millan"
date: "2023-03-14"
output: html_document
---

```{r, echo=FALSE, include=FALSE}
library(car)
library(zoo)
library(plotly)
library(ggplot2)
library(forecast)
library(ggfortify)
library(TSstudio)
```


# Titulo

...

# Indice

...

# Introducción

El propósito al estudio de este proyecto consiste en obtener previsiones a partir de la última observación registrada de una serie temporal seleccionada. No sin antes haber realizado un análisis e informe exhaustivos acerca de la observaciones de la serie y sus propiedades. 

Tal estudio presentado a continuación se compone de una succesión de apartados en donde se empleará la metodología Box-Jenkins mediante modelos ARIMA, así como también la incorporación del tratamiento de observaciones atípicas.


## Descripción Serie Temporal

(descripción serie, variables, tamaño de la muestra, método de recogida de datos)

```{r}
ser <- ts(read.table("Data/export.dat")/1000,start=1999,freq=12)
```


```{r}
ts_plot(ser, slider=FALSE, color='darkblue',
        title="Total exportations in Spain",
        Ytitle="Thousands million euros",
        Xtitle="Time", Xgrid=TRUE, Ygrid=TRUE) %>%
layout(plot_bgcolor = "#e5ecf6", font = list(color = "black"))
```

```{r}
ds <- decompose(ser)

trace1 <- list(name = "Time Series",
               x = time(ser), y = ds$x, xaxis = "x1", yaxis = "y1")
trace2 <- list(name = "Trend",
               x = time(ser), y = ds$trend, xaxis = "x2", yaxis = "y2")
trace3 <- list(name = "Seasonal",
               x = time(ser), y = ds$seasonal, xaxis = "x3", yaxis ="y3")
trace4 <- list(name = "Random", 
               x = time(ser), y = ds$random, xaxis = "x4", yaxis = "y4")

```

```{r}
data <- list(trace1, trace2, trace3, trace4)
ly <- list(title = "Decomposed Time series",
           xaxis1 = list(anchor = "x1", domain = c(0.0, 1.0)),
           xaxis2 = list(anchor = "x2", domain = c(0.0, 1.0)),
           xaxis3 = list(anchor = "x3", domain = c(0.0, 1.0)), 
           xaxis4 = list(anchor = "x4", domain = c(0.0, 1.0)), 
           yaxis1 = list(anchor = "y1", domain = c(0.6, 1.0)), 
           yaxis2 = list(anchor = "y2", domain = c(0.4, 0.6)), 
           yaxis3 = list(anchor = "y3", domain = c(0.2, 0.4)), 
           yaxis4 = list(anchor = "y4", domain = c(0.0, 0.2))
  )

p <- plot_ly()
p <- p %>% add_trace(p, name=trace1$name, x=trace1$x, y=trace1$y,
               xaxis=trace1$xaxis, yaxis=trace1$yaxis, mode='lines')
p <- p %>% add_trace(p, name=trace2$name, x=trace2$x, y=trace2$y, 
               xaxis=trace2$xaxis, yaxis=trace2$yaxis, mode='lines')
p <- p %>% add_trace(p, name=trace3$name, x=trace3$x, y=trace3$y,
               xaxis=trace3$xaxis, yaxis=trace3$yaxis, mode='lines')
p <- p %>% add_trace(p, name=trace4$name, x=trace4$x, y=trace4$y, 
               xaxis=trace4$xaxis, yaxis=trace4$yaxis, mode='lines')
p <- p %>% layout(p, title=ly$title, plot_bgcolor = "#e5ecf6",
            xaxis1=ly$xaxis1, xaxis2=ly$xaxis2, xaxis3=ly$xaxis3,
            xaxis4=ly$xaxis4, yaxis1=ly$yaxis1, yaxis2=ly$yaxis2, 
            yaxis3=ly$yaxis3, yaxis4=ly$yaxis4)
p
```


```{r}
decompose(ser) %>% autoplot()
```



```{r}
library(plotly)
library(forecast)

# Load sample data
data <- AirPassengers

# Convert the data to a time series object
ts_data <- ts(data, frequency = 12, start = c(1949, 1))

# Decompose the time series object using the "stl" function from the "forecast" package
decomposed_data <- stl(ts_data, s.window="periodic")

# Create a list of traces for each component of the decomposed data
traces <- list(
  list(x = time(ts_data), y = ts_data, name = "Original Data", type = "scatter", mode = "lines"),
  list(x = time(ts_data), y = decomposed_data$time.series[,1], name = "Trend", type = "scatter", mode = "lines"),
  list(x = time(ts_data), y = decomposed_data$time.series[,2], name = "Seasonal", type = "scatter", mode = "lines"),
  list(x = time(ts_data), y = decomposed_data$time.series[,3], name = "Remainder", type = "scatter", mode = "lines")
)



# Create a subplot for each component of the decomposed data
subplot_titles <- c("Original Data", "Trend", "Seasonal", "Remainder")


subplot_list <- lapply(seq_along(traces), function(i) {
  subplot(traces[[i]], title = subplot_titles[i],
          margin = list(l=60, r=40, t=40, b=40), yaxis = paste0("y", i))
})

# Combine the subplots into a single plot with shared x-axis
fig <- subplot(subplot_list, shareX = TRUE)

# Set the layout and y-axis titles
fig <- fig %>% layout(title = "Time Series Decomposition", xaxis = list(title = "Year"))
fig <- fig %>% layout(yaxis = list(title = "Passengers"), yaxis2 = list(title = "Trend"), yaxis3 = list(title = "Seasonal"), yaxis4 = list(title = "Remainder"))

fig

```



## Motivación

...

## Metodología

...

## Descripción sintética

...

# Resultados e interpretación

...

## Identificación

...

### Transformación de la serie

...

#### Variancia constante

...

#### Patrón estacional

...

#### Media constante

...

### Serie estacionaria

...

### Modelos propuestos

...

### Estimación modelo 1

...

### Estimación modelo 2

...

## Validación

...

### Variancia constante de residuos

#### Modelo 1

...

#### Modelo 2

### Hipótesis de normalidad de residuos

#### Modelo 1

...

#### Modelo 2

### Independencia de residuos

#### Modelo 1

...

#### Modelo 2

### Propiedad de causalidad y/o estacionalidad

#### Modelo 1

...

#### Modelo 2

### Estabilidad

#### Modelo 1

...

#### Modelo 2

## Previsiones

#### Modelo 1

...

#### Modelo 2

## Tratamiento de atípicos

#### Modelo 1

...

#### Modelo 2

# Conclusiones y discusión

...

# Bibliografía

...






















.